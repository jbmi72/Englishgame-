<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Cyborg Runner - Fixed Animation</title>
    <style>
        body { margin: 0; overflow: hidden; background: #020005; font-family: sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; inset: 0; pointer-events: none; z-index: 10; display: flex; flex-direction: column; align-items: center; color: #00f2ff; }
        .hud { width: 90%; display: flex; justify-content: space-between; padding: 20px; font-size: 20px; font-weight: bold; }
        #q-box { margin-top: 50px; background: rgba(20,0,40,0.9); border: 2px solid #ff00ff; padding: 20px; border-radius: 20px; text-align: center; pointer-events: auto; min-width: 300px; box-shadow: 0 0 20px #ff00ff44; }
        #word { font-size: 45px; color: white; text-shadow: 0 0 10px #ff00ff; }
        #btns { position: absolute; bottom: 50px; display: flex; gap: 15px; pointer-events: auto; }
        .btn { background: #000; border: 2px solid #00f2ff; color: #00f2ff; padding: 15px 30px; font-size: 22px; border-radius: 50px; cursor: pointer; font-weight: bold; text-transform: lowercase; }
        .btn:hover { background: #00f2ff; color: #000; }
        #loading { position: fixed; inset: 0; background: #020005; z-index: 100; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #00f2ff; }
    </style>
</head>
<body>

<div id="loading">טוען גרפיקה...</div>

<div id="ui">
    <div class="hud"><div id="sc">score: 0</div><div id="sp">speed: 1.0x</div><div id="lv">❤️❤️❤️</div></div>
    <div id="q-box"><div id="word">...</div></div>
    <div id="btns">
        <button class="btn" onclick="check(this.innerText)"></button>
        <button class="btn" onclick="check(this.innerText)"></button>
        <button class="btn" onclick="check(this.innerText)"></button>
    </div>
</div>

<canvas id="c"></canvas>

<script>
    const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
    let w, h, score = 0, speed = 1, lives = 3, frame = 0, active = false;
    let currentQ = {}, bgX = 0;

    const spriteImg = new Image(); spriteImg.src = 'cyborg.png';
    const bgImg = new Image(); bgImg.src = 'city.png';

    let assetsLoaded = 0;
    const checkAssets = () => {
        assetsLoaded++;
        if(assetsLoaded >= 2) {
            document.getElementById('loading').style.display = 'none';
            active = true; resize(); next(); loop();
        }
    };
    spriteImg.onload = checkAssets;
    bgImg.onload = checkAssets;

    const wordBank = [
        {h: "הזדמנות", e: "opportunity", alt: ["operation", "opposite"]},
        {h: "סביבה", e: "environment", alt: ["energy", "equipment"]},
        {h: "אחריות", e: "responsibility", alt: ["respect", "response"]},
        {h: "להעריך", e: "appreciate", alt: ["approach", "apply"]},
        {h: "משמעותי", e: "significant", alt: ["scientific", "sufficient"]}
    ];

    function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
    window.onresize = resize;

    function next() {
        currentQ = wordBank[Math.floor(Math.random() * wordBank.length)];
        document.getElementById('word').innerText = currentQ.h;
        let opts = [currentQ.e, ...currentQ.alt].sort(() => Math.random() - 0.5);
        document.querySelectorAll('.btn').forEach((b, i) => b.innerText = opts[i]);
    }

    function check(val) {
        if(val === currentQ.e) { score += 10; speed += 0.1; } 
        else { lives--; speed = Math.max(1, speed - 0.2); }
        document.getElementById('sc').innerText = "score: " + score;
        document.getElementById('sp').innerText = "speed: " + speed.toFixed(1) + "x";
        document.getElementById('lv').innerText = "❤️".repeat(lives);
        if(lives <= 0) location.reload(); else next();
    }

    function loop() {
        if(!active) return;
        ctx.clearRect(0, 0, w, h);

        // 1. ציור הרקע (פרלקסה)
        bgX -= (2 * speed);
        if (bgX <= -w) bgX = 0;
        ctx.drawImage(bgImg, bgX, 0, w, h);
        ctx.drawImage(bgImg, bgX + w, 0, w, h);

        // 2. חישוב חיתוך הדמות (Sprite Animation)
        // התמונה שלך מחולקת ל-8 פריימים בשורה הראשונה
        const cols = 8; 
        const frameWidth = spriteImg.width / cols;
        const frameHeight = spriteImg.height / 2; // בהנחה שיש 2 שורות בתמונה ששלחת
        
        const currentFrame = Math.floor(frame * 0.15 * speed) % cols;

        ctx.save();
        ctx.shadowBlur = 15; ctx.shadowColor = "#00f2ff";
        
        // drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
        ctx.drawImage(
            spriteImg, 
            currentFrame * frameWidth, 0, frameWidth, frameHeight, // המקור (איפה לחתוך)
            150, h - 350, 200, 200 // היעד (איפה לצייר על המסך)
        );
        ctx.restore();

        frame++;
        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
