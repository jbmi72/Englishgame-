<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Cyborg Runner - Ultimate Fix</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; inset: 0; pointer-events: none; z-index: 10; display: flex; flex-direction: column; align-items: center; color: #00f2ff; }
        .hud { width: 95%; display: flex; justify-content: space-between; padding: 20px; font-size: 20px; font-weight: bold; }
        #q-box { margin-top: 30px; background: rgba(10, 0, 30, 0.95); border: 3px solid #ff00ff; padding: 25px; border-radius: 20px; text-align: center; pointer-events: auto; min-width: 350px; }
        #word { font-size: 55px; color: white; text-shadow: 0 0 20px #ff00ff; }
        #btns { position: absolute; bottom: 50px; display: flex; gap: 20px; pointer-events: auto; }
        .btn { background: #000; border: 2px solid #00f2ff; color: #00f2ff; padding: 15px 40px; font-size: 24px; border-radius: 50px; cursor: pointer; font-weight: bold; }
        .btn:hover { background: #00f2ff; color: #000; }
    </style>
</head>
<body>

<div id="ui">
    <div class="hud">
        <div id="sc">SCORE: 0</div>
        <div id="sp">SPEED: 1.0x</div>
        <div id="lv">❤️❤️❤️</div>
    </div>
    <div id="q-box"><div id="word">...</div></div>
    <div id="btns">
        <button class="btn" onclick="check(this.innerText)"></button>
        <button class="btn" onclick="check(this.innerText)"></button>
        <button class="btn" onclick="check(this.innerText)"></button>
    </div>
</div>

<canvas id="c"></canvas>

<script>
    const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
    let w, h, score = 0, speed = 1, lives = 3, frame = 0, active = false;
    let bgX = 0;

    const sprite = new Image(); sprite.src = 'cyborg.png';
    const city = new Image(); city.src = 'city.png';

    // מילון מילים פשוט ומדויק
    const words = [
        {h: "הזדמנות", e: "opportunity", alt: ["operation", "opposite"]},
        {h: "סביבה", e: "environment", alt: ["energy", "equipment"]},
        {h: "אחריות", e: "responsibility", alt: ["respect", "response"]},
        {h: "להעריך", e: "appreciate", alt: ["approach", "apply"]},
        {h: "משמעותי", e: "significant", alt: ["scientific", "sufficient"]}
    ];

    let currentQ = {};

    Promise.all([
        new Promise(r => sprite.onload = r),
        new Promise(r => city.onload = r)
    ]).then(() => { active = true; resize(); next(); loop(); });

    function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
    window.onresize = resize;

    function next() {
        currentQ = words[Math.floor(Math.random() * words.length)];
        document.getElementById('word').innerText = currentQ.h;
        let opts = [currentQ.e, ...currentQ.alt].sort(() => Math.random() - 0.5);
        document.querySelectorAll('.btn').forEach((b, i) => b.innerText = opts[i]);
    }

    function check(val) {
        if(val === currentQ.e) { score += 10; speed += 0.15; } 
        else { lives--; speed = Math.max(1, speed - 0.2); }
        document.getElementById('sc').innerText = "SCORE: " + score;
        document.getElementById('sp').innerText = "SPEED: " + speed.toFixed(1) + "x";
        document.getElementById('lv').innerText = "❤️".repeat(lives);
        if(lives <= 0) location.reload(); else next();
    }

    function loop() {
        if(!active) return;
        ctx.clearRect(0, 0, w, h);

        // --- רקע (העיר) ---
        // הפתרון לפסים: מציירים את התמונה כך שתכסה את הגובה, והרוחב מחושב לפי הפרופורציה של התמונה המקורית
        let bgAspect = city.width / city.height;
        let drawWidth = h * bgAspect;
        bgX -= (4 * speed);
        if (bgX <= -drawWidth) bgX = 0;
        
        ctx.drawImage(city, bgX, 0, drawWidth, h);
        ctx.drawImage(city, bgX + drawWidth, 0, drawWidth, h);

        // --- דמות (הסייבורג) ---
        // הגדרנו 8 עמודות. כדי למנוע "פסים", אנחנו מצמצמים מעט את אזור החיתוך (Padding)
        const cols = 8;
        const rows = 2;
        const fw = sprite.width / cols;
        const fh = sprite.height / rows;
        const currentFrame = Math.floor(frame * 0.15 * speed) % cols;

        ctx.save();
        ctx.shadowBlur = 20; ctx.shadowColor = "#00f2ff";
        
        // כאן התיקון: חותכים פנימה ב-2 פיקסלים מכל צד כדי להעלים שאריות של דמויות אחרות
        ctx.drawImage(
            sprite, 
            currentFrame * fw + 2, 2, fw - 4, fh - 4, 
            150, h - 350, 200, 200
        );
        ctx.restore();

        frame++;
        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
